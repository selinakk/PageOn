<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::content})}">
<head>
    <meta charset="UTF-8">
    <title>자유게시판</title>
    <link rel="stylesheet" type="text/css" href="board.css">
    <style>
        .img-thumbnail {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
<div th:fragment="content">
    <div class="container mt-5">
        <h3 class="mb-4" th:text="${category == 'free' ? '자유 게시판' : '질문 게시판'}">게시판</h3>

        <div class="board-container d-flex align-items-start">
            <!-- 게시판 선택 -->
            <div class="d-flex mr-3">
                <div class="card text-center board-card" th:classappend="${category == 'free'} ? 'border-primary' : ''"
                     onclick="location.href='/freeboard'">
                    <div class="card-body">
                        <h5 class="card-title">자유 게시판</h5>
                    </div>
                </div>
                <div class="card text-center board-card ml-3"
                     th:classappend="${category == 'qna'} ? 'border-primary' : ''"
                     onclick="location.href='/qnaboard'">
                    <div class="card-body">
                        <h5 class="card-title">질문 게시판</h5>
                    </div>

                </div>
                <!-- 추후 회원 로그인 추가후 수정할것 -->
                <div class="d-flex justify-content-between mt-3">
                    <!-- 게시글 수정 버튼 -->
                    <a th:href="@{/b_update(num=${vo2.num})}" class="btn btn-primary">게시글수정</a>

                    <!-- 게시글 삭제 버튼 -->
                    <form th:action="@{/b_deleteOK}" method="post" id="deleteForm">
                        <input type="hidden" name="num" th:value="${vo2.num}">
                        <input type="hidden" name="category" th:value="${vo2.category}">
                        <button type="button" class="btn btn-danger" onclick="confirmDelete()">게시글삭제</button>
                    </form>

                    <!-- 신고하기 버튼 -->
                    <form th:action="@{/b_reportOK}" method="post" id="reportForm">
                        <input type="hidden" name="num" th:value="${vo2.num}">
                        <button type="button" class="btn btn-warning" onclick="confirmReport()">신고</button>
                    </form>
                </div>
            </div>
        </div>




        <div class="card p-4">
            <!-- 게시글 정보 테이블 -->
            <table class="table table-bordered">
                <thead>
                <tr>
                    <td th:text="${vo2.num}"></td>
                    <td th:text="${vo2.title}"></td>
                    <td th:text="${vo2.user_id}"></td>
                    <td th:text="${vo2.wdate}"></td>
                </tr>
                </thead>
            </table>
            <div>
                <img th:src="@{/resources/upload_img/{img_name}(img_name=${vo2.img_name})}" class="img-thumbnail">
                <p th:utext="${vo2.formattedContent}"></p> <!-- th:utext를 사용하여 HTML 태그를 해석 -->
            </div>


        </div>



        <section id="comment" class="position-relative padding-small">
            <h3>댓글</h3>
            <div class="replyForm">
                <textarea id="commentText" rows="4" placeholder="댓글을 입력하세요... 500자 이내"></textarea>
                <input type="hidden" id="bnum" th:value="${vo2.num}">
                <input type="hidden" id="type" value="board">
                <img src="/img/comment_write.png" alt="대댓글 작성" onclick="submitComment()" class="comment-icon"/>
            </div>

            <div id="commentList">
                <div th:each="comment : ${comments}" class="comment" th:id="'comment-' + ${comment.num}">
                    <p>
                        <strong th:text="${comment.user_id}"></strong>:
                        <span th:text="${comment.content}" class="comment-content"></span>
                    </p>
                    <p>작성일: <span th:text="${comment.wdate}"></span></p>
                    <div class="actionButtons">
                        <img src="/img/comment_child.png" alt="대댓글 더보기" th:onclick="'fetchChildComments(' + ${comment.num} + ')'" class="comment-icon"/>
                        <img src="/img/comment_childup.png" alt="대댓글 줄이기" th:onclick="'hideComment(' + ${comment.num} + ')'" class="comment-icon"/>
                        <img src="/img/comment_write.png" alt="대댓글 작성" th:onclick="'showReplyForm(' + ${comment.num} + ')'" class="comment-icon"/>
                        <img src="/img/comment_update.png" alt="수정" th:onclick="'editComment(' + ${comment.num} + ')'" class="comment-icon"/>
                        <img src="/img/comment_delete.png" alt="삭제" th:onclick="'deleteComment(' + ${comment.num} + ')'" class="comment-icon"/>
                        <img src="/img/comment_report.png" alt="신고" th:onclick="'reportComment(' + ${comment.num} + ')'" class="comment-icon"/>
                    </div>

                    <!-- 대댓글 입력 폼 -->
                    <div class="replyForm" th:id="'replyForm-' + ${comment.num}" style="display:none;">
                        <textarea th:id="'replyText-' + ${comment.num}" rows="2" placeholder="대댓글을 입력하세요..."></textarea>
                        <img src="/img/comment_write.png" alt="작성" th:onclick="'submitReply(' + ${comment.num} + ')'" class="comment-icon"/>
                        <img src="/img/comment_delete.png" alt="취소" th:onclick="'cancelReply(' + ${comment.num} + ')'" class="comment-icon"/>
                    </div>

                    <div class="editForm" th:id="'editForm-' + ${comment.num}" style="display:none;">
                        <textarea th:id="'editText-' + ${comment.num}" rows="2" th:text="${comment.content}"></textarea>
                        <img src="/img/comment_update.png" alt="수정" th:onclick="'submitEdit(' + ${comment.num} + ')'" class="comment-icon"/>
                        <img src="/img/comment_delete.png" alt="취소" th:onclick="'cancelEdit(' + ${comment.num} + ')'" class="comment-icon"/>
                    </div>

                    <div class="childComments" th:id="'childComments-' + ${comment.num}">
                        <!-- 대댓글을 가져올 공간 -->
                    </div>

                    <div th:id="'paging-' + ${comment.num}" style="display:none;">
                        <!-- 페이징을 위한 div 추가 -->
                    </div>
                </div>
            </div>

            <div id="paging" th:if="${totalPageCount > 1}">
                <ul>
                    <li th:if="${cpage > 1}">
                        <a th:href="@{/b_selectOne(num=${vo2.num}, cpage=${cpage - 1}, pageBlock=${pageBlock})}">이전</a>
                    </li>
                    <li th:each="i : ${#numbers.sequence(1, totalPageCount)}" th:classappend="${i == cpage} ? 'active'">
                        <a th:href="@{/b_selectOne(num=${vo2.num}, cpage=${i}, pageBlock=${pageBlock})}" th:text="${i}"></a>
                    </li>
                    <li th:if="${cpage < totalPageCount}">
                        <a th:href="@{/b_selectOne(num=${vo2.num}, cpage=${cpage + 1}, pageBlock=${pageBlock})}">다음</a>
                    </li>
                </ul>
            </div>

        </section>



    </div>
</div>



</body>
</html>
