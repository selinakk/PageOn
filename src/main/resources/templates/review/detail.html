<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::content})}">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="'PageOn ë¦¬ë·° ' + ${vo2.title} + ' ìƒì„¸ë³´ê¸°'"></title>
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/sub.css" rel="stylesheet">
    <link href="/review/styles.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body  th:fragment="content">
<div class="position-relative padding-medium">
    <div class="container">
        <div class="section-title d-md-flex justify-content-between align-items-center mb-4">
            <h3 class="d-flex align-items-center">ë¦¬ë·° ìƒì„¸ë³´ê¸°</h3>
        </div>
        <div >
            <div class="side-bar">
                <span>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#reportModal">ì‹ ê³ ğŸš¨</a>
                    <span th:if="${vo2.user_id} == ${session.id}">
                        <a th:href="@{/review/update(num=${vo2.num})}" th:text="ìˆ˜ì •"></a>
                          <a href="#" data-bs-toggle="modal" data-bs-target="#deleteModal">ì‚­ì œ</a>
                    </span>
                </span>
        </div>
        <div class="review-container">
            <img class="img-view" th:src="@{${vo2.workImg}}" th:alt="|${vo2.workTitle} ì‘í’ˆ ì´ë¯¸ì§€|">
            <div th:class="review-position" >
                <p><h4 class="text-auto" th:text="'[ ' + ${vo2.workTitle}+' ] ì— ëŒ€í•œ ë¦¬ë·°'"></h4></p>

                <p ><small th:text="'ì‘ì„±ì¼: '+${vo2.wdate}"></small></p>
                <p ><h3 th:text="${vo2.title}"></h3></p>
                <a th:href="@{/user/userprofile(id=${vo2.user_id})}" class="d-inline-flex align-items-center">
                      <span class="user-profile col-2 d-inline-flex me-2 border border-dark align-middle align-content-center justify-content-center">
                        <img class="w-100 h-100" th:src="${vo2.imgDataAsBase64}" th:alt="|${vo2.userName}ë‹˜ í”„ë¡œí•„ ì´ë¯¸ì§€|">
                      </span>
                <strong th:text="${vo2.userName}"></strong>
            </a>
                <p  id="reviewContent" ><h7 th:text="'ë‚´ìš©: '+${vo2.content}"></h7></p>
                <p ><h7  th:text="'â˜… '+${vo2.rating}"></h7></p>
                <div id="review-detail" th:data-num="${vo2.num}">
                    <button id="like-button">ğŸ‘ <span id="like-count" th:text="${vo2.like}"></span></button>
                    <button id="dislike-button">ğŸ‘ <span id="hate-count" th:text="${vo2.hate}"></span></button>
                </div>
                </p>
                <div>
                    <small>
                        <span id="sentimentResult"></span>
                    </small>
                </div>
            </div>
        </div>
    </div>
        <hr>

</div>
<!-- ì—¬ê¸°ê°€ ëŒ“ê¸€ ê´€ë ¨ ë‚´ìš©ì…ë‹ˆë‹¤. ì´ë¶€ë¶„ì„ ë¶€ëª¨ê¸€ì˜ ìƒì„¸ë³´ê¸°ì™€ ì¶”ê°€í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. -->
<section id="comment" class="position-relative my-5">
    <h3>ëŒ“ê¸€</h3>
    <div class="replyForm">
        <textarea id="commentText" rows="4" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”... 500ì ì´ë‚´"></textarea>
        <img src="/img/comment_write.png" alt="ëŒ“ê¸€ ì‘ì„±" th:onclick="'handleCommentClick()'" class="comment-icon"/>
    </div>

    <div id="commentList">
        <div th:each="comment : ${comments}" class="comment" th:id="'comment-' + ${comment.num}">
            <p>
                <strong th:text="${comment.user_id}"></strong>:
                <span th:text="${comment.content}" class="comment-content"></span>
            </p>
            <p>ì‘ì„±ì¼: <span th:text="${#dates.format(comment.wdate, 'yyyy-MM-dd')}"></span></p>
            <div class="actionButtons">
                <img src="/img/comment_child.png" alt="ëŒ€ëŒ“ê¸€ ë”ë³´ê¸°" th:onclick="'fetchChildComments(' + ${comment.num} + ')'" class="comment-icon"/>
                <img src="/img/comment_childup.png" alt="ëŒ€ëŒ“ê¸€ ì¤„ì´ê¸°" th:onclick="'hideComment(' + ${comment.num} + ')'" class="comment-icon"/>
                <img src="/img/comment_write.png" alt="ëŒ€ëŒ“ê¸€ ì‘ì„±" th:onclick="'handleReplyClick(' + ${comment.num} + ')'" class="comment-icon"/>
                <span th:if="${comment.user_id == session.id}">
                    <img src="/img/comment_update.png" alt="ìˆ˜ì •" th:onclick="'editComment(' + ${comment.num} + ')'" class="comment-icon"/>
                    <img src="/img/comment_delete.png" alt="ì‚­ì œ" th:onclick="'deleteComment(' + ${comment.num} + ')'" class="comment-icon"/>
                </span>
                <img src="/img/comment_report.png" alt="ì‹ ê³ " th:onclick="'handleReportClick(' + ${comment.num} + ')'" class="comment-icon"/>
            </div>

            <!-- ëŒ€ëŒ“ê¸€ ì…ë ¥ í¼ -->
            <div class="replyForm" th:id="'replyForm-' + ${comment.num}" style="display:none;">
                <textarea th:id="'replyText-' + ${comment.num}" rows="2" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                <img src="/img/comment_write.png" alt="ì‘ì„±" th:onclick="'submitReply(' + ${comment.num} + ')'" class="comment-icon"/>
                <img src="/img/comment_delete.png" alt="ì·¨ì†Œ" th:onclick="'cancelReply(' + ${comment.num} + ')'" class="comment-icon"/>
            </div>

            <div class="editForm" th:id="'editForm-' + ${comment.num}" style="display:none;">
                <textarea th:id="'editText-' + ${comment.num}" rows="2" th:text="${comment.content}"></textarea>
                <img src="/img/comment_update.png" alt="ìˆ˜ì •" th:onclick="'submitEdit(' + ${comment.num} + ')'" class="comment-icon"/>
                <img src="/img/comment_delete.png" alt="ì·¨ì†Œ" th:onclick="'cancelEdit(' + ${comment.num} + ')'" class="comment-icon"/>
            </div>

            <div class="childComments" th:id="'childComments-' + ${comment.num}">
                <!-- ëŒ€ëŒ“ê¸€ì„ ê°€ì ¸ì˜¬ ê³µê°„ -->
            </div>

            <div th:id="'paging-' + ${comment.num}" style="display:none;">
                <!-- í˜ì´ì§•ì„ ìœ„í•œ div ì¶”ê°€ -->
            </div>
        </div>
    </div>

    <div id="paging" th:if="${totalPageCount > 1}">
        <ul>
            <li th:each="i : ${#numbers.sequence(1, totalPageCount)}" th:classappend="${i == cpage} ? 'active'">
                <a th:href="@{/test(cpage=${i}, pageBlock=${pageBlock})}" th:text="${i}"></a>
            </li>
        </ul>
    </div>
</section>
    <div class="d-flex justify-content-center py-3">
        <a href="/review/list" class="btn btn-dark">ëª©ë¡ìœ¼ë¡œ</a>
    </div>
<script src="//code.jquery.com/jquery.min.js"></script>
<script th:inline="javascript">
    function displayRating(rating) {
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 >= 0.5 ? 1 : 0;
        const emptyStars = 5 - fullStars - halfStar;

        let stars = 'â˜…'.repeat(fullStars) + 'â˜†'.repeat(emptyStars);
        if (halfStar) {
            stars = stars.slice(0, -emptyStars) + 'Â½' + 'â˜†'.repeat(emptyStars - 1);
        }
        return stars;
    }

    const averageRating = 4.3;
    console.log(displayRating(averageRating)); // ì˜ˆ: "â˜…â˜…â˜…â˜…Â½â˜†"






//ì¢‹ì•„ìš” ìƒˆë¡œê³ ì¹¨ ì—†ì´ ë°”ë¡œ view
$(document).ready(function() {
    $('#like-button').click(function() {
        var reviewNum = $('#review-detail').data('num'); // 'vo2.num ê°’ ê°€ì ¸ì˜¤ê¸°

        // AJAX ìš”ì²­
        $.ajax({
            url: '/likeUpOK',
            type: 'POST',
            data: { num: reviewNum }, // ìš”ì²­ ë°ì´í„°
            success: function(response) {
                // ì„œë²„ë¡œë¶€í„° ë°›ì€ ì‘ë‹µ ì²˜ë¦¬
                $('#like-count').text(response.likeCount); // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
            },
            error: function(xhr, status, error) {
                console.error("Error: " + error);
            }
        });
    });
});


$(document).ready(function() {
    $('#dislike-button').click(function() {
        var reviewNum = $('#review-detail').data('num');


        $.ajax({
            url: '/dislikeUpOK',
            type: 'POST',
            data: { num: reviewNum },
            success: function(response) {

                $('#hate-count').text(response.hateCount);
            },
            error: function(xhr, status, error) {
                console.error("Error: " + error);
            }
        });
    });
});

window.addEventListener('DOMContentLoaded', function (){
    var content = $('#reviewContent').text();  // ë¦¬ë·° ë‚´ìš©ì„ ê°€ì ¸ì˜´

    // AJAXë¡œ ê°ì • ë¶„ì„ API í˜¸ì¶œ
            $.ajax({
                url: '/analyzeOK',
                type: 'POST',
                data: { content: content },
                success: function(result) {
                    $('#sentimentResult').text(result);  // ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œ
                },
                error: function(err) {
                    $('#sentimentResult').text('ê°ì • ë¶„ì„ ì‹¤íŒ¨: ' + err.responseText);
                }
            });
        });


var rnum = [[${vo2.num}]]; // vo2.num ê°’ì„ ì •ìˆ˜ë¡œ ì €ì¥
const sessionId = [[${session.id}]];

function fetchChildComments(commentId, page = 1) {
    const childCommentsDiv = $('#childComments-' + commentId);
    const pagingDiv = $('#paging-' + commentId);

    // AJAX ìš”ì²­
    $.ajax({
        type: "GET",
        url: "/comments/child/" + commentId + "?cpage=" + page,
        success: function(response) {
            const childComments = response.childComments;
            const totalPageCount = response.totalPageCount;

            // ëŒ€ëŒ“ê¸€ì„ ì¶”ê°€
            childCommentsDiv.empty();
            if (childComments.length > 0) {
                childComments.forEach(function(childComment) {
                    const isOwner = childComment.user_id === sessionId; // ì„¸ì…˜ IDì™€ ëŒ“ê¸€ ì‘ì„±ì ID ë¹„êµ
                    const formattedDate = new Date(childComment.wdate).toISOString().split('T')[0];
                    const childCommentElem = `
                    <div class="childComment" id="childComment-${childComment.num}">
                        <p><strong>${childComment.user_id}:</strong> ${childComment.content}</p>
                        <p>ì‘ì„±ì¼: <span>${formattedDate}</span></p>
                        <p>
                            <img src="/img/comment_child.png" alt="ëŒ€ëŒ“ê¸€ ë”ë³´ê¸°" onclick="fetchChildComments(${childComment.num})" class="comment-icon"/>
                            <img src="/img/comment_childup.png" alt="ëŒ€ëŒ“ê¸€ ì¤„ì´ê¸°" onclick="hideComment(${childComment.num})" class="comment-icon"/>
                            <img src="/img/comment_write.png" alt="ëŒ€ëŒ“ê¸€ ì‘ì„±" onclick="handleReplyClick( ${childComment.num}, true)" class="comment-icon"/>
                            ${isOwner ? `
                                <img src="/img/comment_update.png" alt="ìˆ˜ì •" onclick="editComment(${childComment.num}, true)" class="comment-icon"/>
                                <img src="/img/comment_delete.png" alt="ì‚­ì œ" onclick="deleteComment(${childComment.num}, true)" class="comment-icon"/>
                            ` : ''}
                            <img src="/img/comment_report.png" alt="ì‹ ê³ " onclick="handleReportClick(${childComment.num}, true)" class="comment-icon"/>
                        </p>

                        <div class="replyForm" id="childReplyForm-${childComment.num}" style="display:none;">
                            <textarea id="replyText-${childComment.num}" rows="2" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                            <img src="/img/comment_write.png" alt="ì‘ì„±" onclick="submitReply(${childComment.num}, true)" class="comment-icon"/>
                            <img src="/img/comment_delete.png" alt="ì·¨ì†Œ" onclick="cancelReply(${childComment.num}, true)" class="comment-icon"/>
                        </div>

                        <div class="editForm" id="childEditForm-${childComment.num}" style="display:none;">
                            <textarea id="editText-${childComment.num}" rows="2" text="${childComment.content}"></textarea>
                            <img src="/img/comment_update.png" alt="ìˆ˜ì •" onclick="submitEdit(${childComment.num}, true)" class="comment-icon"/>
                            <img src="/img/comment_delete.png" alt="ì·¨ì†Œ" onclick="cancelEdit(${childComment.num}, true)" class="comment-icon"/>
                        </div>

                        <div class="childComments" id="childComments-${childComment.num}">
                            <!-- ëŒ€ëŒ“ê¸€ì˜ ëŒ€ëŒ“ê¸€ì„ ê°€ì ¸ì˜¬ ê³µê°„ -->
                        </div>

                        <div id="paging-${childComment.num}" style="display:none;">
                            <!-- í˜ì´ì§•ì„ ìœ„í•œ div ì¶”ê°€ -->
                        </div>
                    </div>
                    `;
                    childCommentsDiv.append(childCommentElem);
                });
            }

            // í˜ì´ì§• ì •ë³´ ì¶”ê°€
            updatePaging(pagingDiv, totalPageCount, page, commentId);
            childCommentsDiv.show();
            pagingDiv.show();
        },
        error: function() {
            alert("ëŒ€ëŒ“ê¸€ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    });
}

// í˜ì´ì§• ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
function updatePaging(pagingDiv, totalPageCount, currentPage, commentId) {
    pagingDiv.empty(); // ê¸°ì¡´ í˜ì´ì§• ë‚´ìš©ì„ ì§€ìš°ê¸°

    // í˜ì´ì§€ ìˆ˜ê°€ 1 ì´í•˜ì¼ ê²½ìš° í˜ì´ì§• divë¥¼ ìˆ¨ê¹€
    if (totalPageCount <= 1) {
        pagingDiv.hide();
        return;
    }

    // í˜ì´ì§€ ë§í¬ ì»¨í…Œì´ë„ˆ ìƒì„± (ê°€ë¡œ ì •ë ¬ì„ ìœ„í•œ flex ì»¨í…Œì´ë„ˆ)
    const pageLinksContainer = $('<div class="page-links-container"></div>').css({
        display: 'flex',
        'justify-content': 'center',
        'flex-direction': 'row'
    });

    // í˜ì´ì§€ ë§í¬ ìƒì„±
    for (let i = 1; i <= totalPageCount; i++) {
        const pageLink = $(`<span class="page-link" onclick="fetchChildComments(${commentId}, ${i})">${i}</span>`);
        if (i === currentPage) {
            pageLink.addClass('active'); // í˜„ì¬ í˜ì´ì§€ ê°•ì¡°
        }
        pageLinksContainer.append(pageLink);
    }

    // í˜ì´ì§€ ë§í¬ ì»¨í…Œì´ë„ˆë¥¼ pagingDivì— ì¶”ê°€í•˜ê³ , í‘œì‹œ
    pagingDiv.append(pageLinksContainer);
    pagingDiv.show();
}

function hideComment(commentId) {
    const childCommentsDiv = $('#childComments-' + commentId); // ëŒ€ëŒ“ê¸€ div
    const toggleButton = childCommentsDiv.siblings('img[alt="ëŒ€ëŒ“ê¸€ ì¤„ì´ê¸°"]'); // ì¤„ì´ê¸° ë²„íŠ¼
    const showMoreButton = childCommentsDiv.siblings('img[alt="ëŒ€ëŒ“ê¸€ ë”ë³´ê¸°"]'); // ë”ë³´ê¸° ë²„íŠ¼
    const pagingDiv = $('#paging-' + commentId); // í˜ì´ì§• div

    // ëŒ€ëŒ“ê¸€ ëª©ë¡ ìˆ¨ê¸°ê¸°
    childCommentsDiv.hide(); // ëŒ€ëŒ“ê¸€ ëª©ë¡ ìˆ¨ê¸°ê¸°
    toggleButton.hide(); // ì¤„ì´ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    showMoreButton.show(); // ë”ë³´ê¸° ë²„íŠ¼ ë³´ì´ê¸°
    pagingDiv.hide(); // í˜ì´ì§• ìˆ¨ê¸°ê¸°
}

function submitComment() {
    const commentText = $('#commentText').val().trim();
    if (!commentText) {
        alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }

    $.ajax({
        type: "POST",
        url: "/comments",
        contentType: "application/json",
        data: JSON.stringify({
            content: commentText,
            type: "review", // ë¶€ëª¨ê¸€ íƒ€ì…
            rnum: rnum, // ë¶€ëª¨ê¸€id
            user_id: sessionId // ë¡œê·¸ì¸id
        }),
        success: function() {
            location.reload();
        },
        error: function() {
            alert("ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    });
}

function submitReply(parentId) {
    const replyText = $(`#replyText-${parentId}`).val().trim();
    if (!replyText) {
        alert("ëŒ€ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }

    $.ajax({
        type: "POST",
        url: "/comments",
        contentType: "application/json",
        data: JSON.stringify({
            content: replyText,
            type: "review", // ë¶€ëª¨ê¸€ íƒ€ì…
            rnum: rnum, // ë¶€ëª¨ê¸€id
            cnum: parentId,
            user_id: sessionId // ë¡œê·¸ì¸id
        }),
        success: function() {
            location.reload();
        },
        error: function() {
            alert("ëŒ€ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    });
}

function showReplyForm(commentId, isChild = false) {
    // ëŒ€ëŒ“ê¸€ì˜ IDì— ë§ì¶° í¼ IDë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •
    const formId = isChild ? 'childReplyForm-' + commentId : 'replyForm-' + commentId;
    document.getElementById(formId).style.display = 'block'; // í•´ë‹¹ í¼ì„ ë³´ì´ê²Œ í•¨
}

function cancelReply(commentId, isChild = false) {
    const formId = isChild ? 'childReplyForm-' + commentId : 'replyForm-' + commentId;
    document.getElementById(formId).style.display = 'none'; // í•´ë‹¹ í¼ ìˆ¨ê¸°ê¸°
}

function editComment(commentId, isChild = false) {
    // ëŒ€ëŒ“ê¸€ì˜ IDì— ë§ì¶° ìˆ˜ì • í¼ ID ì„¤ì •
    const editFormId = isChild ? `#childEditForm-${commentId}` : `#editForm-${commentId}`;
    const commentElemId = isChild ? `#childComment-${commentId}` : `#comment-${commentId}`;

    // ëŒ€ëŒ“ê¸€ ë˜ëŠ” ì¼ë°˜ ëŒ“ê¸€ì—ì„œ ì½˜í…ì¸ ë¥¼ ê°€ì ¸ì˜´
    const commentContentElem = $(commentElemId).find('p').first();

    // ì‘ì„±ìì˜ ì´ë¦„ê³¼ ë‚´ìš©ì„ ë¶„ë¦¬í•˜ì—¬ ë‚´ìš©ë§Œ ê°€ì ¸ì˜´
    const fullCommentText = commentContentElem.length > 0 ? commentContentElem.text().trim() : '';

    // ì‘ì„±ì ì´ë¦„ê³¼ ë‚´ìš© ë¶„ë¦¬ (ì‘ì„±ì: ë‚´ìš© í˜•íƒœ)
    const contentStartIndex = fullCommentText.indexOf(':') + 2; // ': ' ë‹¤ìŒ ì¸ë±ìŠ¤ë¶€í„° ì‹œì‘
    const commentText = fullCommentText.substring(contentStartIndex).trim(); // ë‚´ìš©ë§Œ ì¶”ì¶œ

    // ê¸°ì¡´ ë‚´ìš©ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì—ì–´ë¦¬ì–´ë¥¼ ì—…ë°ì´íŠ¸
    $(editFormId).find('textarea').val(commentText);
    $(editFormId).show(); // ìˆ˜ì • í¼ì„ ë³´ì´ê²Œ í•¨
}

function submitEdit(commentId) {
    const newCommentText = $(`#editText-${commentId}`).val().trim();

    $.ajax({
        type: "PUT",
        url: "/comments/" + commentId,
        contentType: "application/json",
        data: JSON.stringify({
            content: newCommentText,
            user_id: sessionId // ë¡œê·¸ì¸id
        }),
        success: function() {
            location.reload();
        },
        error: function() {
            alert("ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    });
}

function cancelEdit(commentId, isChild = false) {
    const editFormId = isChild ? '#childEditForm-' + commentId : '#editForm-' + commentId;
    $(editFormId).hide(); // í•´ë‹¹ ìˆ˜ì • í¼ ìˆ¨ê¸°ê¸°
}

function deleteComment(commentId, isChild = false) {
    if (confirm("ì •ë§ë¡œ ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        $.ajax({
            type: "DELETE",
            url: "/comments/" + commentId,
            success: function() {
                const commentSelector = isChild ? `#childComment-${commentId}` : `#comment-${commentId}`;
                $(commentSelector).remove();
            },
            error: function() {
                alert("ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }
}

function reportComment(commentId) {
    // ì‹ ê³  ìš”ì²­ì„ ë³´ë‚´ëŠ” AJAX í˜¸ì¶œ
    $.ajax({
        type: "PUT",
        url: "/comments/report/" + commentId, // ì‹ ê³ ë¥¼ ì²˜ë¦¬í•  ê²½ë¡œ
        success: function() {
            alert("ëŒ“ê¸€ì´ ì‹ ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        },
        error: function() {
            alert("ëŒ“ê¸€ ì‹ ê³ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    });
}

    document.addEventListener("DOMContentLoaded", function () {
        function openLoginModal(event) {
            event.preventDefault();
            const modal = new bootstrap.Modal(document.getElementById('exampleModal'));
            modal.show();
        }

        // ëŒ“ê¸€ ì‘ì„± í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        window.handleCommentClick = function() {
            if (!sessionId) {
                openLoginModal(event);
            } else {
                // ì„¸ì…˜ì´ ìˆì„ ê²½ìš° ëŒ“ê¸€ ì‘ì„± ê¸°ëŠ¥ ìˆ˜í–‰
                submitComment();
            }
        }

        // ëŒ€ëŒ“ê¸€ ì‘ì„± í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        window.handleReplyClick = function(commentNum, isChild = false) {
            if (!sessionId) {
                openLoginModal(event);
            } else {
                // ëŒ€ëŒ“ê¸€ ì‘ì„± ê¸°ëŠ¥ í˜¸ì¶œ
                showReplyForm(commentNum, isChild);
            }
        }

        // ì‹ ê³  í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        window.handleReportClick = function(commentNum, isChild = false) {
            if (!sessionId) {
                openLoginModal(event);
            } else {
                // ì‹ ê³  ê¸°ëŠ¥ í˜¸ì¶œ
                reportComment(commentNum, isChild);
            }
        }
    });


    function confirmReport() {
        // ì‚¬ìš©ìì—ê²Œ ì‹ ê³  í™•ì¸ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³ , "í™•ì¸"ì„ ëˆ„ë¥´ë©´ trueë¥¼ ë°˜í™˜
        if (confirm("ì •ë§ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í•´ë‹¹ ì‹ ê³ ê¸€ì„ ê´€ë¦¬ìê°€ ê´€ë¦¬í•©ë‹ˆë‹¤")) {
            // í¼ ìš”ì†Œë¥¼ ê°€ì ¸ì˜´
            const form = document.getElementById("reportForm");
            // í¼ ë°ì´í„°ë¥¼ FormData ê°ì²´ë¡œ ìƒì„±
            const formData = new FormData(form);

            // fetch APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° POST ìš”ì²­ì„ ë³´ëƒ„
            fetch(form.action, {
                method: 'POST', // HTTP ë©”ì„œë“œë¥¼ POSTë¡œ ì„¤ì •
                body: formData  // ìš”ì²­ ë³¸ë¬¸ì— í¼ ë°ì´í„°ë¥¼ í¬í•¨
            })
                // ì„œë²„ ì‘ë‹µì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
                .then(response => response.text())
                // ë³€í™˜ëœ í…ìŠ¤íŠ¸ë¥¼ alertë¡œ í‘œì‹œ
                .then(data => {
                    alert(data);
                })
                // ìš”ì²­ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì½˜ì†”ì— ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì¶œë ¥
                .catch(error => console.error('Error:', error));
        }
    }

</script>
</div>
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                ì •ë§ í•´ë‹¹ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </div>
            <div class="modal-footer">
                <a class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</a>
                <a class="btn btn-danger" th:href="@{/review/deleteOK(num=${vo2.num})}">ì‚­ì œ</a>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                ì •ë§ í•´ë‹¹ ë¦¬ë·°ë¥¼ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </div>
            <div class="modal-footer">
                <a class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</a>
                <a class="btn btn-danger" th:href="@{/review/reportOK(num=${vo2.num})}">ì‹ ê³ </a>
            </div>
        </div>
    </div>
</div>
</body>
</html>
